{% extends "history_base.html" %}
{% load staticfiles%}

{% block custom-head %}
    {{ block.super }}
    <link rel="stylesheet" href="{% static 'css/leaflet.css' %}" />
    <link rel="stylesheet" href="{% static 'css/jquery-ui.min.css' %}" />
    <style type="text/css">
        .map { height: 600px; width: 100%; }
        .leaflet-container { background: #fff; }
        .leaflet-control-container .slider { height: 10px; }
        #leaflet-slider { background-color: #eee; /*display: none;*/ }
    </style>
{% endblock %}

{% block content-title %}
{% if LANGUAGE_CODE == "en" %}
TECI
{% else %}
TECI
{% endif %}
{% endblock %}

{% block content-body %}
    <p>Total Edge Contrast Index (TECI) adalah indeks numerik yang menunjukkan derajat kekontrasan antara suatu bidang tutupan lahan yang ditentukan sebagai fokus pada bentang alam (landscape) dengan jenis-jenis tutupan lahan lain yang berbatasan langsung dengan bidang tersebut (McGarigal et al. 2012). Jenis tutupan yang dijadikan sebagai fokus dalam kajian biodiversitas di skala bentang alam adalah tutupan lahan yang penting dan menjadi prioritas dalam pelestarian keanekaragaman hayati (mis. area habitat, tempat persinggahan jenis-jenis migran, area perkembangbiakan satwa, dll.). Dalam suatu bentang lahan yang memiliki beraneka ragam ekosistem alami, dapat terdapat lebih dari satu tutupan lahan yang menjadi fokus; Provinsi Sumatera Selatan memiliki tiga tutupan lahan yang menjadi fokus, yaitu: hutan lahan kering, hutan rawa, dan hutan bakau. Dalam kajian ini, tutupan lahan yang menjadi fokus merupakan jenis tutupan yang mewakili kondisi tidak terganggu (pristine) karena kondisi tersebut dianggap paling baik dalam menopang kelestarian keanekaragaman hayati (Dewi et al. 2013).
Dalam bentang alam, dua jenis tutupan lahan yang berbatasan langsung (bersebelahan) secara spasial memiliki pengaruh kuat dalam menentukan pergerakan komponen ekologis antar keduanya (pergerakan organisme, nutrien, energi, dll.)(Formann & Gordon 1986). Oleh karena itu, dalam kajian keanekaragaman hayati di skala bentang alam pengaruh dari jenis tutupan lahan yang berbatasan dengan suatu bidang jenis tutupan lahan fokus turut diperhitungkan. Jenis tutupan lahan memiliki derajat kemiripan dan ketidakmiripan (kekontrasan) yang beragam satu dengan lainnya karena pengaruh dari variasi kondisi iklim mikro, substrat, topografis, dll. Kondisi ideal dalam aspek pelestarian keanekaragaman hayati di bentang alam diasumsikan tercapai apabila bidang tutupan lahan yang menjadi fokus berbatasan langsung dengan jenis lain yang memiliki derajat kemiripan tinggi, atau dengan kata lain memiliki derajat kekontrasan yang rendah. Untuk menghitung kekontrasan suatu bidang tutupan lahan yang menjadi fokus dengan jenis tutupan lahan di sekitarnya pada suatu bentang alam secara keseluruhan atau per bagiannya digunakan indeks TECI.
</p>
    <div class="row">
        <div class="col s12 m3 right-align"><a class="btnPrev waves-effect waves-light btn">&laquo;</a></div>
        <div class="col s12 m6 center-align">
            <ul class="collection" style="margin: 0;">
                <li id="btnInfo_mangrove" class=" collection-item" style="padding: 7px 20px;">
                    {% if LANGUAGE_CODE == "en" %}Mangrove 1990{% else %}Mangrove 1990{% endif %}
                </li>
            </ul>
        </div>
        <div class="col s12 m3 left-align"><a  class="btnNext waves-effect waves-light btn">&raquo;</a></div>
    </div>

    <div class="row">
      <div class="col s12 m12 l10 offset-l1" style="border: 1px solid #aaa; padding: 15px;">
        <div id="mangrove" class="map"></div>
      </div>
    </div>
    
    <div class="row">
        <div class="col s12 m3 right-align"><a class=" btnPrev waves-effect waves-light btn">&laquo;</a></div>
        <div class="col s12 m6 center-align">
            <ul class="collection" style="margin: 0;">
                <li  class="btnInfo collection-item" style="padding: 7px 20px;">
                    {% if LANGUAGE_CODE == "en" %}Swamp Forest 1990{% else %}Swamp Forest 1990{% endif %}
                </li>
            </ul>
        </div>
        <div class="col s12 m3 left-align"><a class="btnNext waves-effect waves-light btn">&raquo;</a></div>
    </div>

    <div class="row">
      <div class="col s12 m12 l10 offset-l1" style="border: 1px solid #aaa; padding: 15px;">
        <div id="swampForest" class="map"></div>
      </div>
    </div>

     <div class="row">
        <div class="col s12 m3 right-align"><a id="btnPrev" class="waves-effect waves-light btn">&laquo;</a></div>
        <div class="col s12 m6 center-align">
            <ul class="collection" style="margin: 0;">
                <li class="btnInfo" class="collection-item" style="padding: 7px 20px;">
                    {% if LANGUAGE_CODE == "en" %}Terr Forest 1990{% else %}Terr Forest 1990{% endif %}
                </li>
            </ul>
        </div>
        <div class="col s12 m3 left-align"><a class="btnNext" class="waves-effect waves-light btn">&raquo;</a></div>
    </div>

    <div class="row">
      <div class="col s12 m12 l10 offset-l1" style="border: 1px solid #aaa; padding: 15px;">
        <div id="terrForest" class="map"></div>
      </div>
    </div>
 
    <div class="row">
        <div class="col s12 m12 l10 offset-l1">
            {% if LANGUAGE_CODE == "en" %}
            <p align="center"><img class="responsive-img" src="{% static 'data/raster/history_teci/MapLegend_color_scale.png' %}" />
            {% else %}
            <p align="center"><img class="responsive-img" src="{% static 'data/raster/history_teci/MapLegend_color_scale.png' %}" />
            {% endif %}
        </div>
    </div>

{% endblock %}

{% block custom-footer %}
<script src="{% static 'js/jquery-ui.min.js' %}"></script>
<script src="{% static 'js/jquery.ui.touch-punch.min.js' %}"></script>
<script src="{% static 'js/leaflet.js' %}"></script>
<script src="{% static 'js/leaflet.SliderControl2.min.js' %}"></script>
<script type="text/javascript">
    
{% if LANGUAGE_CODE == "en" %}
    var raster = 
    { 
       mangrove : [
            {time: "1990", name: "Mangrove 1990", file: "TECI_map_mang_1990_his.png"},
            {time: "2000", name: "Mangrove 2000", file: "TECI_map_mang_2000_his.png"},
            {time: "2005", name: "Mangrove 2005", file: "TECI_map_mang_2005_his.png"},        
            {time: "2010", name: "Mangrove 2010", file: "TECI_map_mang_2010_his.png"},
            {time: "2014", name: "Mangrove 2014", file: "TECI_map_mang_2014_his.png"}
        ],
        swampForest : [
            {time: "1990", name: "Mangrove 1990", file: "TECI_map_mang_1990_his.png"},
            {time: "2005", name: "Mangrove 2000", file: "TECI_map_mang_2000_his.png"},
            {time: "2000", name: "Mangrove 2005", file: "TECI_map_mang_2005_his.png"},        
            {time: "2010", name: "Mangrove 2010", file: "TECI_map_mang_2010_his.png"},
            {time: "2014", name: "Mangrove 2014", file: "TECI_map_mang_2014_his.png"}
        ],
        terrForest : [
            {time: "1990", name: "Mangrove 1990", file: "TECI_map_mang_1990_his.png"},
            {time: "2005", name: "Mangrove 2000", file: "TECI_map_mang_2000_his.png"},
            {time: "2000", name: "Mangrove 2005", file: "TECI_map_mang_2005_his.png"},        
            {time: "2010", name: "Mangrove 2010", file: "TECI_map_mang_2010_his.png"},
            {time: "2014", name: "Mangrove 2014", file: "TECI_map_mang_2014_his.png"}
        ],
    }
{% else %}
    var raster = 
    { 
       mangrove : [
            {time: "1990", name: "Mangrove 1990", file: "TECI_map_mang_1990_his.png"},
            {time: "2005", name: "Mangrove 2000", file: "TECI_map_mang_2001_his.png"},
            {time: "2000", name: "Mangrove 2005", file: "TECI_map_mang_2005_his.png"},        
            {time: "2010", name: "Mangrove 2010", file: "TECI_map_mang_2012_his.png"},
            {time: "2014", name: "Mangrove 2014", file: "TECI_map_mang_2014_his.png"}
        ],
        swampForest : [
            {time: "1990", name: "Swamp forrest 1990", file: "TECI_map_swamp_1990_his.png"},
            {time: "2005", name: "Swamp forrest 2000", file: "TECI_map_swamp_2000_his.png"},
            {time: "2000", name: "Swamp forrest 2005", file: "TECI_map_swamp_2005_his.png"},        
            {time: "2010", name: "Swamp forrest 2010", file: "TECI_map_swamp_2010_his.png"},
            {time: "2014", name: "Swamp forrest 2014", file: "TECI_map_swamp_2014_his.png"}
        ],
        terrForest : [
            {time: "1990", name: "Terr forest 1990", file: "TECI_map_terr_1990_his.png"},
            {time: "2005", name: "Terr forest 2000", file: "TECI_map_terr_2000_his.png"},
            {time: "2000", name: "Terr forest 2005", file: "TECI_map_terr_2005_his.png"},        
            {time: "2010", name: "Terr forest 2010", file: "TECI_map_terr_2010_his.png"},
            {time: "2014", name: "Terr forest 2014", file: "TECI_map_terr_2014_his.png"}
        ],
    }
{% endif %}
    $.getJSON("{% static 'data/geojson/batas_admin.geojson' %}", function(data){
        LoadMap('mangrove', data);

    });
    function LoadMap(mapID,data) {  
        var map1 = new L.Map('mangrove');
        var map2 = new L.Map('swampForest');
        var map3 = new L.Map('terrForest');

        //var sliderControl = L.control.sliderControl();

        //$.getJSON("{% static 'data/geojson/batas_admin.geojson' %}", function(data){
            var mapData = L.geoJson(data);
            var mapBound = mapData.getBounds();
            //mapData.addTo(map);

            var lgroup1 = L.layerGroup();
            var lgroup2 = L.layerGroup();
            var lgroup3 = L.layerGroup();

            raster['mangrove'].map( function(val,i) {
                //console.log(val.name)
                var layerPath = "{% static 'data/raster/history_teci/' %}" + val.file  ;
                var imglayer = L.imageOverlay(layerPath, mapBound, { time: val.time });
                lgroup1.addLayer(imglayer);
            });
            
            var sliderControl1 = L.control.sliderControl({ position: "topright", layer:lgroup1, id: 'mangrove_slider' });
            map1.addControl(sliderControl1);
            sliderControl1.startSlider();            
            map1.fitBounds(mapBound);

            raster['swampForest'].map( function(val,i) {
                //console.log(val.name)
                var layerPath = "{% static 'data/raster/history_teci/' %}" + val.file  ;
                var imglayer = L.imageOverlay(layerPath, mapBound, { time: val.time });
                lgroup2.addLayer(imglayer);
            });
            
            var sliderControl2 = L.control.sliderControl({ position: "topright", layer:lgroup2, id:  'swampForest_slider' });
            map2.addControl(sliderControl2);
            sliderControl2.startSlider();            
            map2.fitBounds(mapBound);

            raster['terrForest'].map( function(val,i) {
                //console.log(val.name)
                var layerPath = "{% static 'data/raster/history_teci/' %}" + val.file  ;
                var imglayer = L.imageOverlay(layerPath, mapBound, { time: val.time });
                lgroup3.addLayer(imglayer);
            });
            
            var sliderControl3 = L.control.sliderControl({ position: "topright", layer:lgroup3, id: 'terrForest_slider' });
            map3.addControl(sliderControl3);
            sliderControl3.startSlider();            
            map3.fitBounds(mapBound);
            //console.log($( "#leaflet-slider" ).slider( "slide" ));
        //});
    }

    $(".btnPrev").on( "click", function() { 
        SlideMap($( "#mangrove_slider" ).slider("value") - 1); 
    });
    $(".btnNext").on( "click", function() { 
        SlideMap($( "#mangrove_slider" ).slider("value") + 1); 
    });

    function SlideMap(value, mapID) {
        var slider = $( "#mangrove_slider" );
        slider.slider("value", value);
        slider.slider("option", "slide")(null, { value: value })
        //console.log(raster['mangrove'][value].name);
        $("#btnInfo_mangrove").html(raster['mangrove'][slider.slider('value')].name);
    }

</script>
{% endblock %}